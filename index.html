<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Department Budget Allocation</title>
  <style>
    :root {
      --primary-color: #3f51b5;
      --secondary-color: #f5f5f5;
      --accent-color: #ff4081;
      --text-color: #333;
      --light-gray: #e0e0e0;
      --danger-color: #f44336;
      --danger-bg: #ffebee;
      --success-color: #4caf50;
    }

    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      margin: 0;
      padding: 20px;
      background-color: #f9f9f9;
      color: var(--text-color);
      min-width: 1400px;
      /* Prevent wrapping on small screens */
    }

    .container {
      max-width: 100%;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      overflow-x: auto;
      /* Allow horizontal scrolling */
    }

    h1 {
      color: var(--primary-color);
      margin-top: 0;
      margin-bottom: 20px;
      font-weight: 500;
    }

    .header-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--light-gray);
    }

    .filters select {
      padding: 8px 12px;
      border: 1px solid var(--light-gray);
      border-radius: 4px;
      margin-right: 10px;
      font-size: 14px;
    }

    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #303f9f;
    }

    button:disabled {
      background-color: #9e9e9e;
      cursor: not-allowed;
    }

    button.danger {
      background-color: var(--danger-color);
      margin-top: auto;
      /* Pushes button to the bottom */
      align-self: flex-end;
      /* Aligns button to the right */
      width: 150px;
    }

    button.save {
      background-color: var(--success-color);
    }

    button.danger:hover {
      background-color: #d32f2f;
    }

    button.save:hover {
      background-color: #45a049;
    }

    .employee-box {
      border: 1px solid var(--light-gray);
      border-radius: 8px;
      margin-bottom: 10px;
      padding: 10px;
      background-color: white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      transition: border-color 0.3s;
    }

    .employee-box.error {
      border-color: var(--danger-color);
      background-color: var(--danger-bg);
    }

    .employee-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .employee-info {
      display: grid;
      grid-template-columns: 1fr 1fr 150px 150px;
      gap: 15px;
      margin-bottom: 15px;
    }

    .employee-info .field-group {
      display: flex;
      flex-direction: column;
    }

    .field-group label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }

    .field-group input {
      padding: 8px;
      border: 1px solid var(--light-gray);
      border-radius: 4px;
      font-size: 14px;
    }

    .field-group input:disabled {
      background-color: var(--secondary-color);
      cursor: not-allowed;
    }

    .column-headers {
      display: grid;
      grid-template-columns: 30px 80px 200px 80px repeat(12, minmax(65px, 1fr));
      gap: 5px;
      margin-bottom: 10px;
      font-weight: 500;
      font-size: 13px;
      color: #555;
      padding: 1 1px;
      width: 100%;
      /* Fixed width to prevent wrapping */
      justify-items: center;
      text-align: center;
    }

    .allocation-line {
      display: grid;
      grid-template-columns: 30px 80px 200px 80px repeat(12, minmax(65px, 1fr));
      gap: 5px;
      margin-bottom: 1px;
      justify-items: center;
      text-align: center;
      padding: 1px 1px;
      border-radius: 4px;
      background-color: var(--secondary-color);
      width: 100%;
      /* Fixed width to prevent wrapping */
    }

    .allocation-line button.delete-line {
      width: 24px;
      height: 24px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      background-color: transparent;
      color: #999;
    }

    .allocation-line button.delete-line:hover {
      color: var(--danger-color);
    }

    .allocation-line select,
    .allocation-line input {
      padding: 6px;
      border: 1px solid var(--light-gray);
      border-radius: 4px;
      font-size: 13px;
      width: 100%;
    }

    .allocation-line input.monthly-input {
      text-align: right;
    }

    .allocation-actions {
      margin-top: 15px;
      display: flex;
      justify-content: flex-end;
    }

    .error-message {
      color: var(--danger-color);
      font-size: 13px;
      margin-top: 10px;
    }

    .grand-total {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid var(--light-gray);
    }

    .grand-total-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .grand-total-row span:first-child {
      font-weight: 500;
    }

    .grand-total-row span:last-child {
      font-size: 18px;
      color: var(--primary-color);
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 200px;
    }

    .error-text {
      color: var(--danger-color);
    }

    .save-section {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid var(--light-gray);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .save-info {
      color: #666;
      font-size: 14px;
    }

    .validation-summary {
      color: var(--danger-color);
      font-size: 14px;
      margin-right: 20px;
    }

    /* Media Queries */

    @media (max-width: 1200px) {

      .allocation-line {

        grid-template-columns: 30px 80px 150px 80px repeat(12, minmax(50px, 1fr));
        /* Adjust for smaller screens */

      }

    }

    @media (max-width: 768px) {

      .allocation-line {

        grid-template-columns: 1fr 1fr 1fr 1fr;
        /* Stack items vertically on very small screens */

      }

    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Department Budget Allocation</h1>

    <div class="header-controls">
      <div class="filters">
        <label for="department-filter">Home Department:</label>
        <select id="department-filter">
          <option value="IT" selected>IT</option>
          <option value="Finance" selected>Finance</option>
          <option value="HR" selected>HR</option>
          <option value="Marketing" selected>Marketing</option>
        </select>

        <label for="iteration-filter">Budget Iteration:</label>
        <select id="iteration-filter">
          <option value="FY25" selected>FY25 (Board Approved)</option>
          <option value="FY25-Q1">FY25-Q1 (Q1 Update)</option>
          <option value="FY25-Q2">FY25-Q2 (Q2 Update)</option>
        </select>
      </div>

      <button id="add-employee-btn" type="button">+ Add New Employee</button>
    </div>

    <div id="employee-containers">
      <!-- Employees will be loaded here dynamically -->
      <div class="loading">Loading employee data...</div>
    </div>

    <div class="grand-total">
      <div class="grand-total-row">
        <span>Total Salaries:</span>
        <span id="total-salaries">$0.00</span>
      </div>
      <div class="grand-total-row">
        <span>Total Allocated to Home Department:</span>
        <span id="total-allocated">$0.00</span>
      </div>
      <div class="grand-total-row">
        <span>Total Allocated to Home Department / Core Fund:</span>
        <span id="total-allocated-core">$0.00</span>
      </div>
    </div>

    <div class="save-section">
      <div>
        <div class="save-info">All changes will be saved to the current iteration: <span
            id="current-iteration-display">FY25</span></div>
        <div id="validation-summary" class="validation-summary"></div>
      </div>
      <button id="save-btn" type="button" class="save">Save Budget Data</button>
    </div>
  </div>


  <script>
    // Replace the script section in index2.html with this updated version
    document.addEventListener('DOMContentLoaded', function () {
      // Global variables
      let budgetData = null;
      let employeeData = [];
      let departments = ['IT', 'Finance', 'Marketing', 'Operations', 'HR'];
      let currentDepartment = 'IT';
      let currentIteration = 'FY25';
      let hasValidationErrors = false;
      let availableIterations = [];

      // Initialize the application
      init();

      async function init() {
        try {
          // Fetch data from API endpoint/JSON file
          await fetchBudgetData();
          setupEventListeners();
          loadIterationData(currentIteration);
          updateIterationUI();
          renderEmployees();
          updateTotals();
          validateAllEmployees();
        } catch (error) {
          console.error('Failed to initialize application:', error);
          document.getElementById('employee-containers').innerHTML =
            `<div class="error-text">Failed to load employee data. Please try again.</div>`;
        }
      }

      async function fetchBudgetData() {
        try {
          // In a real application, this would be a fetch call to an API endpoint
          // For this example, we'll simulate fetching the data
          const response = await fetch('budget-data.json');
          if (!response.ok) {
            throw new Error('Failed to fetch budget data');
          }
          budgetData = await response.json();

          // Extract available iterations from metadata
          availableIterations = budgetData.metadata.availableIterations;

          // Populate iteration dropdown
          const iterationDropdown = document.getElementById('iteration-filter');
          iterationDropdown.innerHTML = '';
          availableIterations.forEach(iteration => {
            const option = document.createElement('option');
            option.value = iteration.id;
            option.textContent = iteration.name;
            if (iteration.id === currentIteration) {
              option.selected = true;
            }
            iterationDropdown.appendChild(option);
          });
        } catch (error) {
          console.error('Failed to fetch budget data:', error);
          throw error;
        }
      }

      function loadIterationData(iterationId) {
        const iteration = budgetData.iterations.find(iter => iter.iterationId === iterationId);
        if (!iteration) {
          console.error(`Iteration with ID ${iterationId} not found`);
          return;
        }

        employeeData = iteration.employees;
        currentIteration = iterationId;
      }

      function updateIterationUI() {
        document.getElementById('current-iteration-display').textContent =
          availableIterations.find(iter => iter.id === currentIteration)?.name || currentIteration;
      }

      function setupEventListeners() {
        // Department filter change event
        document.getElementById('department-filter').addEventListener('change', function (e) {
          currentDepartment = e.target.value;
          renderEmployees();
          updateTotals();
          validateAllEmployees();
        });

        // Iteration filter change event
        document.getElementById('iteration-filter').addEventListener('change', function (e) {
          currentIteration = e.target.value;
          loadIterationData(currentIteration);
          updateIterationUI();
          renderEmployees();
          updateTotals();
          validateAllEmployees();
        });

        // Add new employee button
        document.getElementById('add-employee-btn').addEventListener('click', addNewEmployee);

        // Save button
        document.getElementById('save-btn').addEventListener('click', saveData);
      }

      function renderEmployees() {
        const container = document.getElementById('employee-containers');
        container.innerHTML = '';
        // Filter employees by home department
        const filteredEmployees = employeeData.filter(employee =>
          employee.homeDepartment === currentDepartment
        );

        if (filteredEmployees.length === 0) {
          container.innerHTML = '<div class="loading">No employees found for the selected department.</div>';
          return;
        }

        filteredEmployees.forEach(employee => {
          container.appendChild(createEmployeeBox(employee));
        });
      }

      function createEmployeeBox(employee) {
        const box = document.createElement('div');
        box.className = 'employee-box';
        box.dataset.employeeId = employee.id;

        // Employee header section
        //const header = document.createElement('div');
        //header.className = 'employee-header';

        //const title = document.createElement('h3');
        //title.textContent = employee.name;
        //header.appendChild(title);



        //box.appendChild(header);

        // Employee info section
        const info = document.createElement('div');
        info.className = 'employee-info';

        // Name field
        const nameGroup = document.createElement('div');
        nameGroup.className = 'field-group';
        const nameLabel = document.createElement('label');
        nameLabel.textContent = 'Employee Name';
        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.value = employee.name;
        nameInput.disabled = employee.isExisting;
        nameInput.addEventListener('change', e => updateEmployeeField(employee.id, 'name', e.target.value));
        nameGroup.appendChild(nameLabel);
        nameGroup.appendChild(nameInput);
        info.appendChild(nameGroup);

        // Job Title field
        const titleGroup = document.createElement('div');
        titleGroup.className = 'field-group';
        const titleLabel = document.createElement('label');
        titleLabel.textContent = 'Job Title';
        const titleInput = document.createElement('input');
        titleInput.type = 'text';
        titleInput.value = employee.jobTitle;
        titleInput.addEventListener('change', e => updateEmployeeField(employee.id, 'jobTitle', e.target.value));
        titleGroup.appendChild(titleLabel);
        titleGroup.appendChild(titleInput);
        info.appendChild(titleGroup);

        // Salary field
        const salaryGroup = document.createElement('div');
        salaryGroup.className = 'field-group';
        const salaryLabel = document.createElement('label');
        salaryLabel.textContent = 'Annual Salary';
        const salaryInput = document.createElement('input');
        salaryInput.type = 'text';
        salaryInput.value = formatCurrency(employee.salary);
        salaryInput.addEventListener('change', e => {
          // Get the raw input value, remove non-numeric characters (except dots)
          let rawValue = e.target.value.replace(/[^0-9.]/g, '');

          // Validate if the value is a whole number
          if (!/^\d+$/.test(rawValue)) {  // Check if the value is a whole number
            alert("Please enter a valid whole number.");
            e.target.value = previousValue; // Reset to the previous valid value
          } else {
            // If valid, format and update the input
            e.target.value = formatCurrency(parseInt(rawValue));

            // Remove commas and $ sign before passing to updateSalary
            let cleanValue = e.target.value.replace(/[^0-9.]/g, ''); // Remove any commas and $ sign
            updateSalary(employee.id, parseFloat(cleanValue));

            // Update the previous value to the current valid value
            previousValue = e.target.value; // Save the newly formatted value
          }
        });

        salaryGroup.appendChild(salaryLabel);
        salaryGroup.appendChild(salaryInput);
        info.appendChild(salaryGroup);

        // Delete button for new employees only
        if (!employee.isExisting) {
          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'danger';
          deleteBtn.textContent = 'Delete Employee';
          deleteBtn.addEventListener('click', () => deleteEmployee(employee.id));
          info.appendChild(deleteBtn);
        }

        box.appendChild(info);

        // Column headers
        const headers = document.createElement('div');
        headers.className = 'column-headers';
        headers.innerHTML = `
          <div></div>
          <div>Allocation %</div>
          <div>Department</div>
          <div>% Core</div>
          <div>Jul</div>
          <div>Aug</div>
          <div>Sep</div>
          <div>Oct</div>
          <div>Nov</div>
          <div>Dec</div>
          <div>Jan</div>
          <div>Feb</div>
          <div>Mar</div>
          <div>Apr</div>
          <div>May</div>
          <div>Jun</div>
        `;
        box.appendChild(headers);

        // Allocation lines
        employee.allocations.forEach(allocation => {
          box.appendChild(createAllocationLine(employee.id, allocation));
        });

        // Add allocation button
        const actions = document.createElement('div');
        actions.className = 'allocation-actions';
        const addLineBtn = document.createElement('button');
        addLineBtn.textContent = '+ Add Allocation Line';
        addLineBtn.addEventListener('click', () => addAllocationLine(employee.id));
        actions.appendChild(addLineBtn);
        box.appendChild(actions);

        // Error message container (initially empty)
        const errorMsg = document.createElement('div');
        errorMsg.className = 'error-message';
        errorMsg.id = `error-${employee.id}`;
        box.appendChild(errorMsg);

        return box;
      }

      function createAllocationLine(employeeId, allocation) {
        const line = document.createElement('div');
        line.className = 'allocation-line';
        line.dataset.allocationId = allocation.id;

        // Delete button
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-line';
        deleteBtn.innerHTML = '&times;';
        deleteBtn.addEventListener('click', () => deleteAllocationLine(employeeId, allocation.id));
        line.appendChild(deleteBtn);

        // Allocation percentage
        const percentInput = document.createElement('input');
        percentInput.type = 'text';
        percentInput.min = 0;
        percentInput.max = 100;
        percentInput.value = allocation.percent + '%';
        percentInput.addEventListener('change', e => {
          let value = parseFloat(e.target.value.replace(/[^0-9.]/g, ''));

          // Validate if the value is between 0 and 100
          if (value >= 0 && value <= 100) {
            // If valid, update the value and proceed with the logic
            previousValue = e.target.value; // Update the previous value with the valid one
            updateAllocationPercent(employeeId, allocation.id, parseFloat(e.target.value))
          } else {
            alert('Please enter a value between 0 and 100.');
            // Reset to the previous valid value
            e.target.value = previousValue + '%';
          }
        });
        line.appendChild(percentInput);

        // Department dropdown
        const deptSelect = document.createElement('select');
        departments.forEach(dept => {
          const option = document.createElement('option');
          option.value = dept;
          option.textContent = dept;
          if (dept === allocation.department) {
            option.selected = true;
          }
          deptSelect.appendChild(option);
        });
        deptSelect.addEventListener('change', e =>
          updateAllocationField(employeeId, allocation.id, 'department', e.target.value)
        );
        line.appendChild(deptSelect);

        // Core Allocation percentage
        const percentCoreInput = document.createElement('input');
        percentCoreInput.type = 'text';
        percentCoreInput.min = 0;
        percentCoreInput.max = 100;
        percentCoreInput.value = allocation.percentCore + '%';

        percentCoreInput.addEventListener('change', e => {
          let value = parseFloat(e.target.value.replace(/[^0-9.]/g, ''));

          // Validate if the value is between 0 and 100
          if (value >= 0 && value <= 100) {
            // If valid, update the value and proceed with the logic
            previousValue = value; // Update the previous value with the valid one
            e.target.value = value + '%';
          } else {
            alert('Please enter a value between 0 and 100.');
            // Reset to the previous valid value
            e.target.value = previousValue + '%';
          }
        });
        line.appendChild(percentCoreInput);

        // Monthly values
        allocation.monthlyValues.forEach((value, index) => {
          const monthInput = document.createElement('input');
          monthInput.type = 'text';
          monthInput.className = 'monthly-input';
          monthInput.value = formatCurrency(value);
          monthInput.readOnly = false;
          // Event listener to handle change and format the input value
          monthInput.addEventListener('blur', (e) => { // 'blur' triggers when the user leaves the input box
            let rawValue = e.target.value.replace(/[^0-9.]/g, ''); // Remove non-numeric characters (except dot)

            // Validate if the value is a whole number
            if (!/^\d+$/.test(rawValue)) {  // Check if the value is a whole number
              alert("Please enter a valid whole number.");
              e.target.value = formatCurrency(parseInt(value)); // Reset to the previous valid value
            } else {
              e.target.value = formatCurrency(parseInt(rawValue)); // Format the valid input
            }
          });
          line.appendChild(monthInput);
        });

        return line;
      }

      function addNewEmployee() {
        const newEmployee = {
          id: Date.now(), // Use timestamp as temporary ID
          name: 'New Employee',
          jobTitle: 'Job Title',
          salary: 0,
          homeDepartment: currentDepartment,
          isExisting: false,
          allocations: [
            {
              id: Date.now() + 1, // Another temporary ID
              department: currentDepartment,
              percent: 100,
              monthlyValues: Array(12).fill(0)
            }
          ]
        };

        employeeData.push(newEmployee);
        renderEmployees();
        updateTotals();
        validateAllEmployees();
      }

      function deleteEmployee(employeeId) {
        if (confirm('Are you sure you want to delete this employee?')) {
          employeeData = employeeData.filter(employee => employee.id !== employeeId);
          renderEmployees();
          updateTotals();
          validateAllEmployees();
        }
      }

      function addAllocationLine(employeeId) {
        const employee = findEmployee(employeeId);
        if (!employee) return;

        const newAllocation = {
          id: Date.now(), // Use timestamp as temporary ID
          department: currentDepartment,
          percent: 0,
          percentCore: 100,
          monthlyValues: generateMonthlyValues(employee.salary, 0)
        };

        employee.allocations.push(newAllocation);
        renderEmployees();
        validateAllEmployees();
      }

      function deleteAllocationLine(employeeId, allocationId) {
        const employee = findEmployee(employeeId);
        if (!employee) return;

        if (employee.allocations.length <= 1) {
          alert('Cannot delete the last allocation line. Every employee must have at least one allocation.');
          return;
        }

        employee.allocations = employee.allocations.filter(allocation => allocation.id !== allocationId);
        renderEmployees();
        validateAllEmployees();
        updateTotals();
      }

      function updateEmployeeField(employeeId, field, value) {
        const employee = findEmployee(employeeId);
        if (!employee) return;

        employee[field] = value;
      }

      function updateSalary(employeeId, newSalary) {
        const employee = findEmployee(employeeId);
        if (!employee) return;

        employee.salary = newSalary;

        // Update all allocation monthly values
        employee.allocations.forEach(allocation => {
          allocation.monthlyValues = generateMonthlyValues(newSalary, allocation.percent);
        });

        renderEmployees();
        updateTotals();
        validateAllEmployees();
      }

      function updateAllocationField(employeeId, allocationId, field, value) {
        const employee = findEmployee(employeeId);
        if (!employee) return;

        const allocation = employee.allocations.find(a => a.id === allocationId);
        if (!allocation) return;

        allocation[field] = value;

        // If changing department, may need to update totals
        updateTotals();
        validateAllEmployees();
      }

      function updateAllocationPercent(employeeId, allocationId, newPercent) {
        const employee = findEmployee(employeeId);
        if (!employee) return;

        const allocation = employee.allocations.find(a => a.id === allocationId);
        if (!allocation) return;

        allocation.percent = newPercent;
        allocation.monthlyValues = generateMonthlyValues(employee.salary, newPercent);

        renderEmployees();
        validateAllEmployees();
        updateTotals();
      }

      function validateEmployee(employee) {
        // Check if total allocation is more than 100%
        const totalPercent = employee.allocations.reduce((sum, allocation) =>
          sum + allocation.percent, 0);

        const errorElement = document.getElementById(`error-${employee.id}`);
        const employeeBox = document.querySelector(`.employee-box[data-employee-id="${employee.id}"]`);

        if (totalPercent > 100) {
          errorElement.textContent = 'Error: Total allocation percentage cannot exceed 100%.';
          employeeBox.classList.add('error');
          return false;
        } else {
          errorElement.textContent = '';
          employeeBox.classList.remove('error');
          return true;
        }
      }

      function validateAllEmployees() {
        const filteredEmployees = employeeData.filter(employee =>
          employee.homeDepartment === currentDepartment
        );

        let validationErrors = 0;

        filteredEmployees.forEach(employee => {
          if (!validateEmployee(employee)) {
            validationErrors++;
          }
        });

        // Update save button state
        hasValidationErrors = validationErrors > 0;
        const saveBtn = document.getElementById('save-btn');
        saveBtn.disabled = hasValidationErrors;

        // Update validation summary
        const validationSummary = document.getElementById('validation-summary');
        if (hasValidationErrors) {
          validationSummary.textContent = `Please fix ${validationErrors} validation error${validationErrors > 1 ? 's' : ''} before saving.`;
        } else {
          validationSummary.textContent = '';
        }

        return !hasValidationErrors;
      }

      function updateTotals() {
        const filteredEmployees = employeeData.filter(employee =>
          employee.homeDepartment === currentDepartment
        );

        // Calculate total salaries
        const totalSalary = filteredEmployees.reduce((sum, employee) =>
          sum + employee.salary, 0);

        // Calculate total allocated to home department
        let totalAllocated = 0;
        filteredEmployees.forEach(employee => {
          employee.allocations.forEach(allocation => {
            if (allocation.department === currentDepartment) {
              totalAllocated += (employee.salary * allocation.percent / 100);
            }
          });
        });

        // Calculate total allocated to core
        let totalCore = 0;
        filteredEmployees.forEach(employee => {
          employee.allocations.forEach(allocation => {
            if (allocation.department === currentDepartment) {
              totalCore += (employee.salary * allocation.percent / 100 * allocation.percentCore / 100);
            }
          });
        });

        document.getElementById('total-salaries').textContent = formatCurrency(totalSalary);
        document.getElementById('total-allocated').textContent = formatCurrency(totalAllocated);
        document.getElementById('total-allocated-core').textContent = formatCurrency(totalCore);

      }

      function saveData() {
        if (hasValidationErrors) {
          alert('Please fix all validation errors before saving.');
          return;
        }

        // Find current iteration and update its employee data
        const iterationIndex = budgetData.iterations.findIndex(iter => iter.iterationId === currentIteration);
        if (iterationIndex === -1) {
          alert('Cannot find the current iteration to save.');
          return;
        }
        // Update the employee data in the budget data structure
        budgetData.iterations[iterationIndex].employees = employeeData;

        // In a real application, this would post data to an API endpoint
        const dataToSave = {
          iterationId: currentIteration,
          timestamp: new Date().toISOString(),
          employees: employeeData
        };

        // Simulate API call
        console.log('Saving data:', dataToSave);
        alert(`Data for iteration ${currentIteration} saved successfully.`);
      }

      // Helper functions
      function findEmployee(id) {
        return employeeData.find(employee => employee.id === id);
      }

      function generateMonthlyValues(salary, percent) {
        const baseMonthlyAmount = salary * percent / 100 / 12;
        return Array(12).fill(0).map((_, index) => {
          return Math.round(baseMonthlyAmount);
        });
      }

      function formatCurrency(amount) {
        return '$' + new Intl.NumberFormat().format(amount);
      }
    });
  </script>
</body>

</html>